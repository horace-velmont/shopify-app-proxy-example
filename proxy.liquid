{% layout none %}
<script id="channel-io-widget">
window.profile = {
  memberId : '{{customer.id}}',
  name : '{{customer.name}}',
  email : '{{customer.email}}',
	mobileNumber : '',
  defaultAddressCity : '{{customer.default_address.province}}',
  defaultAddressCountry : '{{customer.default_address.country}}',
  totalPurchaseAmount : (parseFloat('{{customer.total_spent | money_without_currency | default: 0}}')/100).toFixed(2),
  totalPurchaseCount : parseInt('{{customer.orders_count | default: 0}}'),
  lastOrderPriceOrigin : '{{customer.last_order.total_price | money_without_currency | default: 0}}',
  lastOrderPrice : (parseFloat('{{customer.last_order.total_price | money_without_currency | default: 0}}')/100).toFixed(2),
  lastOrderNumberOrigin : '{{customer.last_order.order_number | default: 0}}',
  lastOrderNumber : parseInt('{{customer.last_order.order_number | default: 0}}'),
  lastOrderShippingPrice : (parseFloat('{{customer.last_order.shipping_price | money_without_currency | default: 0}}')/100).toFixed(2),
  lastOrder : '{{customer.last_order}}',
  lastOrderCreatedAt : '{{customer.last_order.created_at}}',
  lastOrderCancelReason : '{{customer.last_order.cancel_reason}}',
  lastOrderCancelledAt : '{{customer.last_order.cancelled_at}}',
  shopifyCustomerTags : [],
  cartPrice : (parseFloat('{{cart.total_price | default: 0}}')/100).toFixed(2),
  cartCount : parseInt('{{cart.item_count | default: 0}}'),
  cartProductIds : [],
  orderedProductIds : [],
  orderedProductVariantIds : [],
  // shopifyOptout : '{{customer.accepts_marketing}}'
};
{% if customer.phone %}
  window.profile.mobileNumber = '{{customer.phone}}';
{% else %}
  window.profile.mobileNumber = '{{customer.default_address.phone}}';
{% endif %}
if (window.profile.lastOrderCreatedAt)
  window.profile.lastOrderCreatedAt = Date.parse(window.profile.lastOrderCreatedAt);
if (window.profile.lastOrderCancelledAt)
  window.profile.lastOrderCancelledAt = Date.parse(window.profile.lastOrderCancelledAt);
{% for item in cart.items limit:51 %}
  var itemId = '{{ item.product_id }}'
  window.profile.cartProductIds.push(itemId);
{% endfor %}
{% for order in customer.orders %}
  {% for item in order.line_items %}
    var itemId = '{{ item.product_id }}'
    var variantId = '{{ item.variant_id }}'
    window.profile.orderedProductIds.push(itemId);
    window.profile.orderedProductVariantIds.push(variantId);
  {% endfor %}
{% endfor %}
{% for tag in customer.tags %}
  var tag = '{{ tag }}';
  window.profile.shopifyCustomerTags.push(tag);
{% endfor %}
</script>
