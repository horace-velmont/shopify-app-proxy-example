{% layout none %}
<script id="channel-io-widget">
window.channelConfig = {
  id : '{{customer.id}}',
  defaultAddress : '{{customer.default_address.address1}}',
  defaultAddressProvince : '{{customer.default_adress.province}}',
  cartTotalPrice : '{{cart.total_price | money | default: 0}}',
  cartItemCount : '{{cart.item_count}}',
  cartProductIds : [],
  checkout : '{{checkout}}',
  checkoutId : '{{checkout.id}}',
  checkoutOrderFinancialStatus : '{{customer.last_order.financial_status}}',
  email : '{{customer.email}}',
  fulfillment : '{{ fulfillment }}',
  fulfillmentItemCount : '{{ fulfillment.itemCount }}',
  fulfillmentTrackingUrl : '{{ fulfillment.tracking_url }}',
  name : '{{customer.name}}',
  mobileNumber : '{{customer.phone}}',
  totalSpent : '{{customer.total_spent}}',
  money : '{{money}}',
  ordersCount : '{{customer.orders_count}}',
  lastOrderTotalPrice : '{{customer.last_order.total_price | money | default: 0}}', 
  lastOrderNumber : '{{customer.last_order.order_number}}',
  lastOrderShippingPrice : '{{customer.last_order.shipping_price | money | default: 0}}',
  lastOrderCreatedAt : '{{customer.last_order.created_at}}',
  lastOrderCancelReason : '{{customer.last_order.cancel_reason}}',
  sellingPlan : '{{selling_plan}}',
  shopifyCustomerTags : [],
  fuls : [],
  shopifyOutput : '{{customer.accepts_marketing}}'
};
{% for item in customer.last_order.line_items %}
   window.channelConfig.fuls.push(item.fulfillment.item_count);
{% endfor %}
{% for item in cart.items %}
  var itemId = '{{ item.id }}'
  window.channelConfig.cartProductIds.push(itemId);
{% endfor %}

{% for tag in customer.tags %}
  var tag = '{{ tag }}';
  window.channelConfig.shopifyCustomerTags.push(tag);
{% endfor %}
</script>
