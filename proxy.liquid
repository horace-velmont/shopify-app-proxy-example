{% layout none %}
<script id="channel-io-widget">
window.channelConfig = {
  id : '{{customer.id}}',
  defaultAddress : '{{customer.default_address.address1}}' + '{{customer.default_address.address2}}',
  defaultAddressCountry : '{{customer.default_address.country}}',
  defaultAddressProvince : '{{customer.default_address.province}}',
  cartTotalPrice : '{{cart.total_price | money | default: 0}}',
  cartItemCount : '{{cart.item_count}}',
  cartProductIds : [],
  orderedProductIds : new Set(),
  orderedProductVariantIds : [],
  email : '{{customer.email}}',
  lastOrderCreatedAt : '{{customer.last_order.created_at}}',
  lastOrderCancelReason : '{{customer.last_order.cancel_reason}}',
  lastOrderFinancialStatus : '{{customer.last_order.financial_status}}',
  lastOrderTotalPrice : '{{customer.last_order.total_price | money | default: 0}}', 
  lastOrderNumber : '{{customer.last_order.order_number}}',
  lastOrderShippingPrice : '{{customer.last_order.shipping_price | money | default: 0}}',
  mobileNumber : '',
  name : '{{customer.name}}',
  ordersCount : '{{customer.orders_count}}',
  shopifyCustomerTags : [],
  totalSpent : '{{customer.total_spent | money | default: 0}}',
  shopifyOutput : '{{customer.accepts_marketing}}'
};
{% if customer.phone %}
  window.channelConfig.mobileNumber = '{{customer.phone}}';
{% else %}
  window.channelConfig.mobileNumber = '{{customer.default_address.phone}}';
{% endif %}
{% for item in cart.items %}
  var itemId = '{{ item.product_id }}'
  window.channelConfig.cartProductIds.push(itemId);
{% endfor %}

{% for order in customer.orders %}
  {% for item in order.line_items %}
    var itemId = '{{ item.product_id }}'
    var variantId = '{{ item.variant_id }}'
    window.channelConfig.orderProductIds.add(itemId);
  {% endfor %}
{% endfor %}

{% for tag in customer.tags %}
  var tag = '{{ tag }}';
  window.channelConfig.shopifyCustomerTags.push(tag);
{% endfor %}
