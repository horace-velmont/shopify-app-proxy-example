{% layout none %}
<script id="channel-io-widget">
window.channelPluginProfile = {
  memberId : '{{customer.id}}',
  name : '{{customer.name}}',
  email : '{{customer.email}}',
	mobileNumber : '',
  totalPurchaseAmount : (parseFloat('{{customer.total_spent | money_without_currency | default: 0}}')/100).toFixed(2),
  totalPurchaseCount : parseInt('{{customer.orders_count | default: 0}}'),
  shopifyCustomerTags : [],
  cartPrice : (parseFloat('{{cart.total_price | default: 0}}')/100).toFixed(2),
  cartCount : parseInt('{{cart.item_count | default: 0}}'),
  latestCartProductIds : [],
  latestOrderedProductIds : []
};

{% if customer.phone %}
  window.profile.mobileNumber = '{{customer.phone}}';
{% else %}
  window.profile.mobileNumber = '{{customer.default_address.phone}}';
{% endif %}

{% for item in cart.items %}
  var itemId = '{{ item.product_id }}'
  window.profile.latestCartProductIds.push(itemId);
{% endfor %}

{% for order in customer.orders %}
  {% for item in order.line_items %}
    var itemId = '{{ item.product_id }}'
    var variantId = '{{ item.variant_id }}'
    window.profile.latestOrderedProductIds.push(itemId);
  {% endfor %}
{% endfor %}

{% for tag in customer.tags %}
  var tag = '{{ tag }}';
  window.profile.shopifyCustomerTags.push(tag);
{% endfor %}

</script>
