{% layout none %}
<script id="channel-io-widget">
window.profile = {
  memberId : '{{customer.id}}',
  defaultAddressCountry : '{{customer.default_address.country}}',
  defaultAddressCity : '{{customer.default_address.province}}',
  cartPrice : parseFloat('{{cart.total_price | default: 0}}')/100,
  cartItemCount : '{{cart.item_count}}',
  cartProductIds : [],
  orderedProductIds : [],
  orderedProductVariantIds : [],
  email : '{{customer.email}}',
  lastOrderCreatedAt : '{{customer.last_order.created_at}}',
  lastOrderCancelReason : '{{customer.last_order.cancel_reason}}',
  lastOrderFinancialStatus : '{{customer.last_order.financial_status}}',
  lastOrderPrice : parseFloat('{{customer.last_order.total_price | money_without_currency | default: 0}}')/100,
  lastOrderNumber : '{{customer.last_order.order_number}}',
  lastOrderShippingPrice : parseFloat('{{customer.last_order.shipping_price | money_without_currency | default: 0}}')/100,
  mobileNumber : '',
  name : '{{customer.name}}',
  totalPurchaseCount : '{{customer.orders_count}}',
  shopifyCustomerTags : [],
  totalPurchaseAmount : parseFloat('{{customer.total_spent | money_without_currency | default: 0}}')/100,
  // shopifyOptout : '{{customer.accepts_marketing}}'
};
{% if customer.phone %}
  window.profile.mobileNumber = '{{customer.phone}}';
{% else %}
  window.profile.mobileNumber = '{{customer.default_address.phone}}';
{% endif %}
{% for item in cart.items %}
  var itemId = '{{ item.product_id }}'
  window.profile.cartProductIds.push(itemId);
{% endfor %}
{% for order in customer.orders %}
  {% for item in order.line_items %}
    var itemId = '{{ item.product_id }}'
    var variantId = '{{ item.variant_id }}'
    window.profile.orderedProductIds.push(itemId);
    window.profile.orderedProductVariantIds.push(variantId);
  {% endfor %}
{% endfor %}
{% for tag in customer.tags %}
  var tag = '{{ tag }}';
  window.profile.shopifyCustomerTags.push(tag);
{% endfor %}
</script>
